<div class="panel panel-default">
    <div class="panel-heading">
        <h2>{{::vm.translate.get(vm.pageTitle)}}</h2>
    </div>
    <div class="panel-body">
        <form name="orderForm" class="form-horizontal">
            <my-validation errors="vm.validationErrors"></my-validation>
            <div>
                <div class="form-group">
                    <!-- <label class="col-sm-2 control-label">{{::vm.translate.get('Customers')}}</label> -->
                    <div class="col-sm-10 col-xs-8">
                        <md-autocomplete 
                            required
                            md-input-name="customer"
                            md-no-cache="false"
                            md-autoselect="true"
                            md-selected-item="vm.customer" 
                            md-search-text="vm.customerQuery" 
                            md-items="item in vm.searchCustomers(vm.customerQuery)"
                            md-item-text="item.display" md-min-length="0" 
                            placeholder="{{::vm.translate.get('Search customers')}}">
                            <md-item-template>
                                <span md-highlight-text="vm.customerQuery" md-highlight-flags="gi">{{item.display}}</span>
                            </md-item-template>
                            <div ng-messages="orderForm.customer.$error" role="alert">
                                <div ng-message="required">This field is required</div>
                            </div>
                            <md-not-found>
                                No customer "{{vm.customerQuery}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                </div>
                <div class="form-group">
                    <!-- <label class="col-sm-2 control-label">{{::vm.translate.get('Products')}}</label> -->
                    <div class="col-sm-10 col-xs-8">
                        <md-autocomplete 
                            style="min-width: 0;"
                            md-no-cache="false"
                            md-autofocus="true"
                            md-autoselect="true"
                            md-selected-item="vm.selectedProduct" 
                            md-search-text="vm.productQuery" 
                            md-items="item in vm.searchProducts(vm.productQuery)"
                            md-item-text="item.display" md-min-length="0" 
                            placeholder="{{::vm.translate.get('Search products')}}"
                            ng-keypress="($event.charCode==13) ? vm.addToCart(vm.selectedProduct) : return">
                            <md-item-template>
                                <span md-highlight-text="vm.productQuery" md-highlight-flags="gi">{{item.display}}</span>
                            </md-item-template>
                            <md-not-found>
                                No product "{{vm.productQuery}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                    <div class="col-sm-2 col-xs-4">
                        <md-button class="md-raised md-primary no-margin-top" ng-disabled="!vm.selectedProduct" 
                            ng-click="vm.addToCart(vm.selectedProduct)">
                            <i class="fa fa-plus">&nbsp;</i>Add
                        </md-button>
                    </div>
                </div>
                <div class="form-group" ng-if="vm.orderId">
                    <!-- <label class="col-sm-2 control-label">{{::vm.translate.get('Order status')}}</label> -->
                    <div class="col-sm-12">
                        <md-input-container>
                            <label>{{::vm.translate.get('Order status')}}</label>
                            <md-select placeholder="{{::vm.translate.get('Select a status')}}" ng-model="vm.orderStatus"
                                        style="min-width: 200px;">
                                <md-option ng-repeat="status in vm.orderStatusList" value="{{status.value}}">{{status.text}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div class="form-group">
                    <!-- <label class="col-sm-2 control-label">{{::vm.translate.get('Selected customer')}}</label> -->
                    <div class="col-sm-10" ng-if="vm.customer">
                        <span><i class="fa fa-user">&nbsp;</i>{{vm.customer.display}}</span>
                    </div>
                </div>
                <div class="form-group">
                    <!-- <label class="col-sm-2 control-label">{{::vm.translate.get('Shopping Cart')}}</label> -->
                    <div class="col-sm-12">
                        <div class="table-responsive">

                        <table class="table table-striped table-condensed vertical-align-middle">
                            <thead>
                                <tr>
                                    <th class="col-sm-1">{{::vm.translate.get('Images')}}</th>
                                    <th class="col-sm-3">{{::vm.translate.get('Name')}}</th>
                                    <th class="col-sm-1 text-center">{{::vm.translate.get('Price')}}</th>
                                    <th class="col-sm-1 text-center">{{::vm.translate.get('Stock')}}</th>
                                    <th class="col-sm-1 text-center">{{::vm.translate.get('Quantity')}}</th>
                                    <th class="col-sm-1 text-center">{{::vm.translate.get('Subtotal')}}</th>
                                    <th class="col-sm-1 text-center">{{::vm.translate.get('Actions')}}</th>
                                </tr>
                            </thead>
                            <tbody ng-show="vm.orderItems.length" class="cart-list">
                                <tr ng-repeat="item in vm.orderItems">
                                    <td class="col-sm-1">
                                        <img ng-src="{{item.productImage}}" alt="{{item.productName}}" width="50">
                                    </td>
                                    <td class="col-sm-3">
                                        <a ui-sref="product-edit({id: item.productId})" target="_blank" title="{{item.productName}}"> 
                                            {{item.display}}
                                        </a>
                                    </td>
                                    <td class="col-sm-1 text-center">{{item.productPrice.toCurrency()}}</td>
                                    <td class="col-sm-1 text-center">
                                       <span ng-if="item.stock > 0">{{item.stock}}</span> 
                                       <span ng-if="item.stock <= 0">Out of stock</span> 
                                    </td>
                                    <td class="col-sm-1">
                                        <md-input-container class="no-margin-bottom no-margin-top hide-validation">
                                            <input type="number" class="text-center" required 
                                            ng-model="item.quantity" min="0" 
                                            ng-change="vm.updateSubtotal(item)"/>
                                        </md-input-container>
                                    </td>
                                    <td class="col-sm-1 text-center">{{item.subTotal.toCurrency()}}</td>
                                    <td class="col-sm-1 text-center">
                                        <button ng-click="vm.removeFromCart(item)" type="button" class="btn">
                                            <span class="fa fa-remove"></span>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="order-summary active">
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-3"></td>
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-1 text-center">{{::vm.translate.get("Subtotal")}}:</td>
                                    <td class="col-sm-1 text-center">{{vm.orderSubTotal.toCurrency()}}</td>
                                    <td class="col-sm-1"></td>
                                </tr>
                                <tr class="active">
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-3"></td>
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-1 text-center">{{::vm.translate.get("Shipping")}}:</td>
                                    <td class="col-sm-1">
                                        <md-input-container class="no-margin-bottom no-margin-top hide-validation">
                                            <input type="number" class="text-center" ng-model="vm.shippingAmount" min="0" ng-change="vm.updateOrderTotal()"/>
                                        </md-input-container>
                                    </td>
                                    <td class="col-sm-1"></td>
                                </tr>
                                <tr class="success">
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-3"></td>
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-1"></td>
                                    <td class="col-sm-1 text-center"><b>{{::vm.translate.get("Total")}}:</b></td>
                                    <td class="col-sm-1 text-center"><b>{{vm.orderTotal.toCurrency()}}</b></td>
                                    <td class="col-sm-1"></td>
                                </tr>
                            </tbody>
                            <tbody ng-show="!vm.orderItems.length">
                                <tr>
                                    <td colspan="10" class="text-center">{{::vm.translate.get("No product")}}</td>
                                </tr>
                            </tbody>
                        </table>

                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <button class="btn btn-primary" ng-disabled="orderForm.$invalid" ng-click="vm.save()">
                            <i class="fa fa-check">&nbsp;</i>{{::vm.translate.get('Save')}}
                        </button>
                        <button ui-sref="order" class="btn btn-default">{{::vm.translate.get('Cancel')}}</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
